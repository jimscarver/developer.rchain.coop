<!DOCTYPE html>
<html>

<head>
    <script src="js/jquery-3.3.1.min.js"></script>
    <title>Rholang Playground - RChain</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
    <link rel='stylesheet' href='css/layout.css' />
    <link rel='stylesheet' href='css/ladl.css' />
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
    <link rel="shortcut icon" href="assets/favicon-red.png" />
    <style>
        pre {
            line-height: 1
        }
    </style>
</head>

<body>
    <div id="navOpen" onclick="navOpen()">
        <div class="burger"></div>
        <div class="burger"></div>
        <div class="burger"></div>
    </div>
    <div class="nav" id="nav">
        <div id="navClose" onclick="navClose()">X</div>
        <div class="item" onclick="">
            <a href="index.html">Home</a>
        </div>
        <div class="item" onclick="">
            <a href="documentation.html">Documentation</a>
        </div>
        <div class="item" onclick="">
            <a href="https://faq.rchain.coop" target="_blank">FAQ</a>
        </div>
        <div class="item" onclick="">
            <a href="token-swap.html">REV Issuance</a>
        </div>
        <div class="item" onclick="">
            <a href="https://rchain.coop" target="_blank">RChain.Coop</a>
        </div>
    </div>

    <div class="masthead">
        <div id="logoWrapper">
            <img src="assets/logo-cropped.png" alt="RChain">
            <div class="textWrapper">
                <h1>RChain</h1>
                <div>Scalable, Secure, Sustainable</div>
            </div>
        </div>
    </div>

    <div class="bodyText">
        <h1>Rholang Playground</h1>

        <form>
            <!-- prettier-ignore -->
            <textarea id='rholang-term' cols="80" rows="16">new world in {
  world!("Hello!")
}
</textarea>
            <br />
            <button id="run">Run</button>
        </form>
        <section id="resultSection" style="display: none">
            <h2>Result</h2>
            <pre id="result"></pre>
            <h2>Block Info</h2>
            <small>
                <pre id="blockInfo"></pre>
            </small>
        </section>
        <section id="problemSection" style="display: none">
            <h3>Problem</h3>
            <pre id="problem"></pre>
        </section>

        <script type="module">
            import { RNode } from './js/rnode.js';
            import { RhoExpr } from './js/rho-expr.js';

            const $ = selector => document.querySelector(selector);
            const pprint = data => JSON.stringify(data, null, 2);
            const hideBlock = elt => { elt.style.display = 'none'; };
            const showBlock = elt => { elt.style.display = 'block'; };

            async function busy(button, p) {
                $('body').style.cursor = 'wait';
                button.style.cursor = 'wait';
                button.disabled = true;
                $()
                try {
                    const result = await p;
                    return result;
                } finally {
                    button.disabled = false;
                    $('body').style.cursor = 'inherit';
                    button.style.cursor = 'inherit';
                }
            }

            window.addEventListener('DOMContentLoaded', () => {
                const node1 = new RNode(fetch).observer('https://observer.testnet.rchain.coop');

                $('#run').addEventListener('click', async (event) => {
                    event.preventDefault();

                    const term = $('#rholang-term').value;
                    hideBlock($('#resultSection'))
                    $('#result').textContent = '';
                    hideBlock($('#problemSection'))
                    $('#problem').textContent = '';
                    try {
                        const { expr, block } = await busy($('#run'), node1.exploratoryDeploy(term));
                        if (expr.length > 0) {
                            const data = expr.map(RhoExpr.parse);
                            $('#result').textContent = pprint(data);
                        }
                        $('#blockInfo').textContent = pprint(block);
                        showBlock($('#resultSection'))
                    } catch (err) {
                        $('#problem').textContent = err.message;
                        showBlock($('#problemSection'))
                    }
                })
            })
        </script>
    </div>

    <div id="footer">
        <div class="footer-social">
            <ul>
                <li><a href="https://www.facebook.com/rchaincooperative/" target="_blank"><img
                            src="assets/fb-circle.png"><span class="socialText">Facebook</span></a></li>
                <li><a href="https://twitter.com/rchain_coop" target="_blank"><img
                            src="assets/twitter-circle2.png"><span class="socialText">Twitter</span></a></li>
                <li><a href="https://github.com/rchain" target="_blank"><img src="assets/github-circle.png"><span
                            class="socialText">Github</span></a></li>
                <li><a href="https://medium.com/rchain-cooperative" target="_blank"><img
                            src="assets/medium-circle.png"><span class="socialText">Medium</span></a></li>
                <li><a href="https://www.reddit.com/r/RChain/" target="_blank"><img
                            src="assets/reddit-circle2.png"><span class="socialText">Reddit</span></a></li>
                <li><a href="https://t.me/rchaincoop" target="_blank"><img src="assets/telegram2.png"><span
                            class="socialText">Telegram</span></a></li>
                <li><a href="https://discord.gg/NWkQnfH" target="_blank"><img src="assets/discord-circle.png"><span
                            class="socialText">Discord</span></a></li>
                <li><a href="https://www.youtube.com/channel/UCSS3jCffMiz574_q64Ukj_w" target="_blank"><img
                            src="assets/youtube-circle.png"><span class="socialText">Youtube</span></a></li>
                <li><a href="https://www.linkedin.com/company/rchain-cooperative/" target="_blank"><img
                            src="assets/linkedin-circle.png"><span class="socialText">Linkedin</span></a></li>
            </ul>
        </div>
        <div class="copy">Â© 2020 RChain Cooperative</div>
    </div>

    <script src="js/developer.rchain.js"></script>
</body>

</html>